<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Sondage</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
</head>
<body>
<form method="post" action="" enctype="multipart/form-data">
    <div class="inputs">
        <label>Âge (10-18 ans)</label>
        <input class="inputText" type="number" id="age" name="age" required placeholder="Insérez votre âge" min="10"
               max="18"><br>
    </div>
    <div class="inputs">
        <label>Ville</label>
        <input class="inputText" type="text" id="ville" name="ville" placeholder="Insérez votre prénom"
               required><br>
    </div>
    <div class="inputs">
        <label>Niveau Scolaire</label>
        <select id="statutscolaire" required>
            {% for niveau in niveaux %}
                <option value="{{ niveau[0] }}">{{ niveau[0] }}</option>
            {% endfor %}
        </select>
    </div>
    <div>
        <input type="checkbox" id="RMatin" name="RMatin" checked>
        <label for="RMatin">Repas du matin</label>
    </div>
    <div class="cache">
        <form method="POST">
            {{ form.crsf_token }}
            {{ form.groupe }}
            {{ form.sous_groupe }}
            {{ form.sous_sous_groupe }}
            {{ form.aliment }}
        </form>

        <div class="inputs">
            <label>Nom de l'aliment</label>
            <input class="inputText" type="text" id="aliment" name="aliment"
                   placeholder="Insérez le nom de l'aliment">
        </div>

    </div>

    <div>
        <input type="checkbox" id="RSoir" name="RSoir" checked>
        <label for="RSoir">Repas du soir</label>
    </div>

    <div class="cache2">
        <div class="inputs">
            <select id="CategorieDaliment">
                <option value="valeur1">Valeur 1</option>
                <option value="valeur2" selected>Valeur 2</option>
                <option value="valeur3">Valeur 3</option>
            </select>
        </div>
        <div class="inputs">
            <select id="SousCategorieDaliment">
                <option value="valeur1">Valeur 1</option>
                <option value="valeur2" selected>Valeur 2</option>
                <option value="valeur3">Valeur 3</option>
            </select>
        </div>
        <div class="inputs">
            <select id="SousSousCategorieDaliment">
                <option value="valeur1">Valeur 1</option>
                <option value="valeur2" selected>Valeur 2</option>
                <option value="valeur3">Valeur 3</option>
            </select>
        </div>
        <div class="inputs">
            <label>Nom de l'aliment</label>
            <input class="inputText" type="text" id="aliment" name="aliment"
                   placeholder="Insérez le nom de l'aliment">


        </div>
    </div>
</form>

<script>
    $(function () {
        var availableTags = [
            {% for ville in villes %}
                "{{ville}}",
            {% endfor %}
        ];
        $("#ville").autocomplete({
            source: availableTags
        });

        let groupe_select = $("#groupe");
        let sousGroupe_select = $("#sous_groupe");
        let sousSousGroupe_select = $("#sous_sous_groupe");
        let aliment_select = $("#aliment");
        groupe.onchange = function () {
            changeSsGrp();
            changeAliment2();
            changeAliment();
        };
        sous_groupe.onchange = function () {
            changeSsSsGrp();
            changeAliment2();
            changeAliment();
        }
        function changeSsGrp() {
            groupe_val = groupe_select.val();
            fetch('/api/sousGroupe/' + groupe_val).then(function (response) {
                response.json().then(function (data) {
                    let optionHTML = '';
                    for (let sousGroupe of data.sousGroupe) {
                        optionHTML += '<option value="' + sousGroupe.id + '">' + sousGroupe.name + '</option>';
                    }
                    sousGroupe_select[0].innerHTML = optionHTML;
                    changeSsSsGrp();
                });
            });



        }
        function changeSsSsGrp() {
            groupe_val = sousGroupe_select.val();
            fetch('/api/sousSousGroupe/' + groupe_val).then(function (response) {
                response.json().then(function (data) {
                    let optionHTML = '';
                    if (data.sousSousGroupe.length <= 1) {
                        sousSousGroupe_select.hide();
                    }
                    for (let sousGroupe of data.sousSousGroupe) {
                        optionHTML += '<option value="' + sousGroupe.id + '">' + sousGroupe.name + '</option>';
                    }
                    sousSousGroupe_select[0].innerHTML = optionHTML;
                    changeAliment2();
                });
            });
        }
        function changeAliment2() {
            var availableTags = [];
            groupe_val = sousSousGroupe_select.val();
            fetch('/api/aliment/' + groupe_val).then(function (response) {
                response.json().then(function (data) {
                    let optionHTML = '';
                    for (let aliment of data.aliment) {
                        optionHTML += '<option value="' + aliment.id + '">' + aliment.name + '</option>';
                    }
                    aliment_select[0].innerHTML = optionHTML;
                });
            });
            $("#aliment").autocomplete({
                source: availableTags
            });
        }
        function changeAliment() {
            var availableTags = [];
            groupe_val = sousSousGroupe_select.val();
            fetch('/api/aliment/' + groupe_val).then(function (response) {
                response.json().then(function (data) {
                    for (let aliment of data.aliment) {
                        availableTags.push(aliment.name);
                    }
                });
            });
            $("#aliment").autocomplete({
                source: availableTags
            });
        }

        changeSsGrp();
        changeSsSsGrp();
        changeAliment2();
    });
</script>
<script type="text/javascript" src="{{ url_for('static', filename='script/script.js') }}"></script>
</body>
</html>